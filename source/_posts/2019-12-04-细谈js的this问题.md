---
title: 细谈js的this问题
author: Dovis
top: false
cover: false
date: 2019-12-04 22:50:54
password:
summary: 让js的this问题不再困扰自己
tags:
    - this
categories:
    - 前端进阶
---
### 关于this对象
在《JavaScript高级程序设计》一书中说明了this对象是运行时基于函数的执行环境绑定的：在全局函数中，this等于window，而当函数被作为某个对象的方法调用时，this等于那个对象。

不过，匿名函数的执行环境具有全局性，因此其this对象通常指向window。
```javascript
    var name = 'lin jia heng'
    var object = {
        name: 'My Object',
        getNameFunc: function () {
            return function () {
                return this.name; //匿名函数的执行环境具有全局性，所以this指向window
            }
        }
    }
    alert(object.getNameFunc()()) // lin jia heng(非严格模式）
```
而下面的例子就可以成功返回“My Object”
```javascript
    var name = 'lin jia heng'
    var object = {
        name: 'My Object',
        getNameFunc: function () {
            return this.name; //当函数被作为某个对象的方法调用时，this等于那个对象
        }
    }
    alert(object.getNameFunc()) // My Object
```
```javascript
    var name = 'lin jia heng'
    var object = {
        name: 'My Object',
        getNameFunc: function () {
            let that = this // 改变this指向
            return function () {
                return that.name; //匿名函数的执行环境具有全局性，所以this指向window
            }
        }
    }
    alert(object.getNameFunc()()) // My Object
```
### 在函数中执行
1. 在非严格模式
```javascript
function func(){
    console.log(this)
}
func() //Window
```
2. 在严格模式
```javascript
function func(){
    console.log(this)
}
func() //undefined
```
这就验证了第一个例子中为什么特意表明在非严格模式下才成立了。

### 作为一个构造函数使用
在JS中，为了实现类我们需要定义一些构造函数，在调用一个构造函数的时候加上new这个关键字：

```javascript
function Person(name) {
    this.name = name;
    console.log(this)
}
var p1 = new Person('kk');
// Person
```
此时this指向这个构造函数调用的时候实例化出来的对象

当然，构造函数其实也是一个函数，如果将构造函数当成普通函数来调用，this指向Window

```javascript
function Person(name) {
    this.name = name;
    console.log(this)
}
var p1 = Person('kk');
// Window
```
### 在定时器中使用
```javascript
setTimeout(function() {
    console.log(this);
},0)// Window，setInterval也一样
```
如果没有特殊指向，定时器的回调函数中this的指向都是Window。这是因为JS的定时器方法是定义在Window下的。

### 在箭头函数中使用

1. 在全局环境中使用：
```javascript
var func = () => {
    console.log(this)
}
func() //Window
```
2. 作为一个对象的一个函数使用：
```javascript
var obj = {
    name: 'hh',
    func: function() {
        console.log(this);
    }
}
obj.func();//obj

var obj = {
    name: 'hh',
    func: () => {
        console.log(this)
    }
}
obj.func(); //Window
```
3. 作为对象的特殊情况，结合定时器来使用：
```javascript
var obj = {
    name: 'hh',
    func: function() {
        setTimeout(function() {
            console.log(this);
        },0)
    }
}
obj.func();// Window

var obj = {
    name: 'hh',
    func: function() {
        setTimeout(() => {
            console.log(this);
        },0)
    }
}
obj.func();// obj
```
> 箭头函数中的this的值取决于该函数外部非箭头函数的this的值，且不能通过call(),apply()和bind()方法来改变this的值。